class Forest {
    constructor(stage, index) {
        this.root = stage.root;
        this.config = stage.config;
        this.loader = stage.loader;
        this.scene = stage.scene;
        this.stage = stage;
        this.index = index;

        this.trees = [...new Array(this.config.forest.size)];
        this.persons = [... new Array(this.config.forest.persons.count)];
        this.persons1 = [... new Array(this.config.forest.persons1.count)];
        this.persons2 = [... new Array(this.config.forest.persons2.count2)];
        this.block1 = [... new Array(this.config.forest.blocks1)];
        this.block2= [... new Array(this.config.forest.blocks2)];
        this.block3 = [... new Array(this.config.forest.blocks3)];
        

        this.grounds = [];
        this.treePositions = [];
        this.blockPositions1 = [];
        this.blockPositions2 = [];
        this.blockPositions3 = [];
        this.workers = getWorkers();
        this.workersSubscriber = [];

        this.groundMaterial = new THREE.MeshLambertMaterial({
            color: this.config.material.color.ground,
            side: THREE.DoubleSide
        });

        this.treeMaterial = new THREE.MeshStandardMaterial({
            color: this.config.material.color.tree,
            roughness: 1.0,
            metalness: 0.3
        });

        this.twigMaterials = {
            'needle-leaf': new THREE.MeshStandardMaterial({
                color: this.config.material.color.twig,
                roughness: 1.0,
                metalness: 0.3,
                alphaTest: 0.1
            }),
            'broad-leaf': new THREE.MeshStandardMaterial({
                color: this.config.material.color.twig,
                roughness: 1.0,
                metalness: 0.3,
                alphaTest: 0.1
            })
        };

        this.loaded = new Promise(async function (resolve) {
            for (const type in this.twigMaterials) {
                this.twigMaterials[type].map = await this.loader.load('texture', `img/${type}.png`);
            }
 
            

            this.init();
            this.addGround();
            this.addTrees();
            this.addPersons();
            this.addPersons2();
            this.update();

            // tree worker message
            this.workersMessage(async (finished) => {
                if (!finished) {
                    return;
                }

                // trees and persons finished
                await Promise.all(this.persons.map((p) => { return p.loaded; }));
                await Promise.all(this.persons2.map((p) => { return p.loaded; }));
                this.stage.status();

                resolve(this);
            });
        }.bind(this));
    }
    
    init() {
        // TODO refactor position logic
        
        
        const coverage = 2 * this.config.drone.height * Math.tan(rad(this.config.drone.camera.view / 2));
        const sizeOuter = this.config.forest.ground + 2 * coverage;
        const sizeInner = this.config.forest.ground ;

        // ground position constraints
        const treeMargin = 1;
        const treePositionMin = -sizeInner /  2.1 + treeMargin;
        const treePositionMax = sizeInner /   2.1 - treeMargin;
        

        // divide ground into grids
        const gridCount = Math.floor(Math.sqrt(this.config.forest.size));
        const gridSize = 2 * treePositionMax / gridCount;
        

        // calculate tree positions
       
    

        // for density 300 (just an example of the positions of the trees. Define a custom list of positions for different tree arrangement on the ground. Default ground size is 100 in the config demo.json. Position of the trees has to be within the range (-50,-50) to (50,50)  )

        var treex_300 = [-31.070054800395702, 39.322567307236845, -18.86775577755071, -20.140911746703487, -17.938452995599345, 28.249951940948904, 33.81218775964912, -40.16605814656119, -37.99260184782714, -27.406175958638705, -43.13940670123346, 12.614486707701943, -18.755852395028327, -10.561233352532719, -29.748327268284346, 22.5733262151657, -5.314956623186057, 26.556145463090317, -39.83133636891495, -19.490526551358446, -7.838723194301499, 28.618028743563528, -20.09318740276355, 27.0272814070799, 8.976936119379058, -35.064073642869346, -35.23777932240696, -36.878423775506114, -15.657029675892069, -9.472333969701673, -18.764499273668847, -26.842674772523836, -3.1178599392112734, -2.6912723878551206, 8.68383864219893, 22.027380545810985, -25.438809771994535, -28.894243402470735, 22.212137965800558, 35.543795969157216, -23.348207475729268, 43.96037164477926, -28.27757208380556, -36.0501052030558, 8.024578711916938, -8.612982250517032, -46.4722911148278, 16.779125388435794, -45.545674436575524, -7.126989304889898, 34.87768095582577, -10.735640507952546, -41.21860165891949, -38.35020166535537, 40.46842663120225, 37.06761910445656, -2.0726357088870606, -8.187431710359698, 14.572745393540847, 3.513945262419756, 28.327460742042657, -23.41355320320321, 0.5921590969031052, -19.304149143990028, 3.8980745771433725, 28.702385811484945, -24.334445055944755, -2.25502837943068, -46.24725096699567, 1.9717576276945588, -39.12701198436291, -9.865232533312401, -18.940852921192178, -16.98177056327374, 22.357948273660313, 42.377316253220016, 22.307443462300427, 26.249263911877737, 5.682376729744419, -2.47072535486896, -6.070688005122108, 41.864685235048846, 35.19653192070519, 8.766227080234787, -37.48262829783896, -9.322448854121482, -27.00580417709906, 31.37793960265436, -31.911606794947936, 14.874140448097135, 12.359988145723277, 41.34244314735894, -34.97329194770978, 6.928433714007236, -25.17365383980507, -30.752498414650628, -39.74932080813749, -8.842913541349446, 3.514619601920089, 39.45927888203486, 31.094153619516852, 2.3669578522127157, -35.10108955852564, -34.15468021622151, -43.01779186038847, -9.024563667337357, 19.477663675103713, 7.327467603970483, -25.002232012488705, 12.643723635217171, 30.552369710773743, 18.00700873990641, -6.264085814057823, -35.37583061370523, 12.446920240548383, 16.608168307104304, 23.908021876626833, -17.25210072852356, 17.061159558110134, 20.958877610767118, 13.53318469398268, 7.395409612777101, 25.795883150790324, 34.881542250191245, 36.659476608854156, 43.76944557924322, 17.766139289850724, 1.6318615175568416, 14.607711784343254, -10.292785769290314, 22.374856062745565, 44.571976783857835, -39.62240513535531, -36.13625590293504, 37.798601979152245, 20.112277441105235, 9.52022156578717, 39.51357014698839, 2.042042411816629, 43.83073507240831, -43.325781852913956, 43.50613989415653, 19.546645224969495, -27.637576220983657, -32.46752601129455, 4.7214563528837274, -35.13679684795733, 10.55857038309803, 36.5519232408752, -5.11666872096929, -32.26593984600035, 45.60992453820653, 7.20229666477189, 45.14350051410289, 2.9268203022008907, 34.09605327608276, 34.92839518235913, -2.445639764764069, 17.102868404396094, 30.850864559124076, -24.646603444263633, -13.253102109646582, 10.668330132049114, -35.22157678906821, 10.305005983713748, 33.83110288689034, 5.440828730099783, -7.67079111170739, 38.161997007332765, 45.410236663210924, -6.254414267442558, 28.113639615518352, 5.635823456238722, -19.81906206726543, -16.559740768939783, -22.98601306009837, -26.87856444866171, 46.15703476689232, -37.73995438311799, -18.790949947203913, -7.269017758104396, 17.406619380279786, 17.318842860123745, -5.27798632068754, 35.76529597425185, -44.38221741404384, 22.7609484662892, 41.48362930557626, -41.19001547468209, -10.997019472318545, 19.653116632918127, 22.273531714064507, -16.011315418166568, 35.469616546826074, 33.031043874351816, 28.129928007201844, -0.46389254055927065, 34.93917471510553, -30.071790471603904, 0.4549361990998837, 46.155588353485456, 42.590185157192835, -26.179755810524654, -20.375735468302558, -18.903475900373518, -13.822755282133096, 2.3372586282475725, -37.36185833046749, -2.088817274519666, 29.056442605250083, 14.998843225658947, -36.889662808016155, 34.67210402680128, -9.228919841360995, -24.558170956883444, 18.850478756330237, 6.578729143982244, 10.633925406695795, -1.3638912472435858, -5.382552790681997, -24.760362809761222, 27.049066730695685, -12.147780661060871, -44.217853928508845, 45.023285285298144, 4.179697579045511, 38.54761710407045, -30.519575254312116, -23.262259935773915, -42.222687731070494, -5.0182326837306945, -19.2160345068726, 28.653663604041547, -2.9156483167539387, 16.633719078321654, -45.37698894400709, -14.055331452742585, 38.30788083286256, 36.010904341775486, 28.69388814092703, 19.2988158789162, 20.59698213455761, 0.3324982630344615, 5.573736371597488, 29.415135144400004, 29.979321108958004, 1.2669028869698211, -23.23639783977817, -17.58485218985435, 2.9111191859359455, 39.79405335211793, 16.225972552578206, -38.37397294359109, -12.613812799750903, 21.9740555775804, -25.98031493930865, -37.75173959817443, 13.486092761499101, -41.468079713654035, 12.767275621627519, 37.226530550407155, 32.67090712098152, 11.114803598931285, -38.62311850293288, -42.32999328043742, 37.07285578561145, -6.342788190726415, -45.11739278215559, -10.630392778701344, -44.7988965217799, 18.75063041281871, 16.934119345077974, -11.590457434462659, -33.618963948542635, -30.83049427769731, -19.515763861546354, -20.233465762800428, 46.51809506413713, -28.57865353005919, -15.756605308954585, 40.20017742282263, -45.634359129004345, 8.331908392830305, -10.94919213069077, -18.372788377960763, -28.959553576967554, -7.618561338410839, -30.51905349381128, 29.735161792377607, 19.594105279671574, -41.36469700512795, 42.9380815458349, -17.671026242348386, -27.67481439195056, 20.476475952366812, -39.83004078095446, 9.685170366670395, 18.558450543415052, -21.36151199166799, -4.589762208269672]
        var treey_300 = [43.522514674951104, -29.023608131686945, 26.839677400331887, 25.232188370889997, 30.486485671634973, -26.77430812767195, 29.81254291928918, 33.52704087994698, 0.40172996079293055, 29.761460254510325, 32.74523656103725, 12.252932291672783, -11.756848877221076, -0.7875994124564711, -34.54290060741843, 25.47674136873231, -28.66981765898757, -1.6879740609947276, 7.281081176335843, -34.54150498646597, 18.177093736669384, -32.827467054955186, 5.582770603438011, 32.97045479917429, -40.55077510528903, -45.96380065373773, 12.007532418460901, -28.318696571484036, -35.142910068012576, 13.346426048710109, 2.622527353240681, -18.496170018836253, 32.14769557900022, -16.135412735772928, -1.0170185655147388, -10.795742784115795, -5.9143790788409945, 2.8141900707379928, -23.896701374106335, -17.324375468249215, -19.197745750091585, 30.103664410862223, -21.134769945207356, 37.2521898142735, 3.373718958444579, -34.718290936976246, 9.802056035782938, -43.63360939155449, -20.52407094716458, -35.048925606664966, -2.6620532673690938, 31.336923904721093, -17.25810946137708, -36.87150139585924, -2.873212628301977, -35.12221455094836, 9.992517522333678, 27.791504150235085, -7.089635885263319, 25.053718011237443, -10.879081376828, -16.470459184864325, -11.930136653140215, 14.838938564395123, -13.40105030685971, -7.653338063117081, -10.983097365646142, 1.9500639316100559, -30.90163058571564, 42.96845354281647, -46.51932093102197, -38.358057285987144, -36.94988549918759, -28.325908523145934, -14.230647470739177, 15.2152422969655, -39.68352422974058, -22.33123542263947, -43.863101397360666, 17.064199844522353, 44.339593682385555, 20.216147430532377, 41.79583276202387, -45.330079195767, -20.64087112193686, -27.61944111283871, 41.006735195037905, 33.73981961584008, -19.93211887385955, 15.940847843223278, -12.516832327152146, 32.43351523038115, -19.08185182409712, 38.17753325500933, 9.533496221628473, 3.242335367096913, 42.50953614610163, -43.86052387590417, -29.40474092880011, 36.40770860280999, 7.188719906498838, -35.21272911084314, -8.009068785629443, -36.00772278037587, 38.53921797968984, 44.92313221590383, 43.75914551133492, -33.08710540909082, -11.604768743142078, -14.633778496996012, -43.67498878440582, 3.715341145631946, 22.268470676261654, -29.847070528959225, -30.973270849011627, -9.086156622751208, 24.636465908229553, 3.9345545229183134, 35.15715948601286, -29.171026480739254, 30.540603393821126, -40.865035956986794, 36.061921781365164, -13.26245290517648, 20.20675378840925, -44.89179035658362, 2.342080971150903, 36.749447973077615, 9.144522323115137, 21.51476127247857, 13.539656910374681, 13.315676607846555, -11.672098771507756, 17.804528831627078, 33.39343536770442, -3.7213717268576074, 36.35412051185529, -19.031639979365274, -29.896101158163894, 0.834980869563791, -25.283905715641783, -21.767384800982715, 40.50373936668224, 46.29253222901929, 27.033760106413173, 21.514201922794804, 0.7334020541902615, 7.559902386199447, -2.450893814980599, -23.159293489080635, -35.26530418843511, -40.33070312962601, -3.7938485892113496, 38.42817974275528, 17.178963268936457, 24.58823230703072, -28.556416697843126, -40.28384737044565, 37.548121199534386, 39.96169437415406, 12.143738105447483, -5.874214641982176, 29.50821413595022, 18.03866742756255, -25.697228641653368, -22.136426867803763, -20.413784497826043, -43.29967165847671, 8.83744763191428, -11.278167190949754, 40.19445374743007, -40.93877879064158, -18.907571219830515, -43.834564731438256, 14.094751882066731, 41.76344952373145, -28.34547566873433, 45.150576195382975, 12.652586065159452, -22.262957530155777, 7.268821395948048, -25.396422830063553, -34.03739207777946, 10.563445993454081, -37.984895038202666, 7.743066719020466, -34.05745836497454, -28.60231419314052, -46.05485374037894, 40.91990032478592, -43.67597537608288, 16.747712763775798, 39.36246902638374, -35.247831135339865, 17.37565961915, 3.392242881867644, 31.70417176837913, -39.74119011398363, -36.49987473743104, 24.30328701216334, 4.900112739414718, -30.251347456475443, -44.749399035816104, -27.965829325176465, 44.02576217841492, -42.161576893031835, -43.9502298468682, 30.040334472749223, 7.32368021188519, 12.575876891555552, 24.239439360395366, -30.49373189404988, 11.18457836924835, -21.092120025731255, 33.193547158927736, -16.746502643463874, 1.3578697728549836, 21.012372992911125, -24.361311799270343, -3.638643958573611, 16.94922082724597, 44.348336894070094, -18.84249607418996, 16.73832737108343, -4.263475010586547, 33.102495180163636, -43.27076518116767, -13.178005271366318, -36.731694880370746, -39.68203037464772, -38.116058307700214, 40.51665933175891, -44.354269522228435, -8.616240133595532, -37.082275867408455, 23.231727644870713, -17.80440258393153, 7.314822025495609, 14.649811878567773, 27.857585852267068, 35.369922835782646, 0.849848521094811, -3.4390401687166197, 11.695185924370067, 16.828514410001766, -14.173306204949725, 25.18941801445079, -4.065226390068715, 8.390570329315992, 43.27250259523887, 46.40541992181856, 27.60924687722345, -18.419711235811086, 29.680995346779348, 3.488629038064477, 30.268348020429283, 22.296570817438635, 45.53875801032882, 24.947392220646595, -19.509765982990743, 26.82539832982581, -7.713259957365945, -6.796773719260678, -4.813925596452497, -5.714976051555304, -23.61586861866251, -18.557762376524195, 0.8658243298187762, 18.11331179226924, 45.370413849387816, 41.88206798977067, -22.374777356863145, 7.644202231853281, 40.76646597674011, 32.247276139884896, 19.73159448432761, -2.052949260365574, -14.715097835863773, -0.3113824345583569, 23.771758094977937, -13.052278214297699, -8.871303460175412, 14.558462082775776, -10.83597390921405, -4.257723943473348, 20.386419626586807, 1.2207199562595026, 23.780458600824005, 21.512901114545006, 36.00293775414709, 7.251887848588539, 0.5058168961420475, 9.796895076232794, 13.567231470574352, 22.567661116673513, 10.490699017291426, 5.536917280087195, 13.334385257108819, 16.432417810139192, 10.396645619279726]

        // for density 400  
        var treey_400 = [25.49964064794652, -27.872677766891695, -1.459858362272679, -21.874070829749545, -13.262706324037204, -21.86083769536868, -41.43988619022531, -42.345838624888145, -43.25928914502247, -16.81701154488993, -18.92015511424802, -17.96012409562812, 8.28532030583355, 5.741241920290082, 9.300730577810924, -44.9438080760813, 9.818908351700497, -38.778080839845245, 22.714626730030353, -22.348321860996403, -45.35795788748871, 21.463721655338116, 16.155020857298446, 13.458097569339635, -41.55364795601592, 22.688147578571773, 11.404340960755246, 14.595707140639764, -37.74267760799792, -39.70393599526956, -46.051734824585395, 4.318989513534634, 5.645592987732549, -36.93202646146032, -35.31128176128114, -42.58883509288215, 6.021964113910476, 8.571932562769003, -20.37304497443726, 1.9906066484006986, -30.42106051003006, -23.853686895358248, -16.108384519542234, 8.10993454333354, -44.753807152498034, 20.318303472840732, -25.977498104761555, 39.09632977636607, -30.235073677327165, 9.879610313216299, 10.238209301397916, 13.841470730188625, -16.252219645323407, 33.52243556491333, 1.3487372994090543, 34.98249561552949, 42.1322472294673, 41.309398737204646, 14.943666913555747, 36.55997484202017, 35.545194628637525, -42.01973303638793, -15.805460783158674, 27.021783752785254, -14.794442123256363, -45.993363708096574, -16.686096451267055, -38.737909792110116, 39.34097722654044, -22.526978399392753, -10.94137685823812, 5.068224841901143, 19.785538007227778, 28.675422291112678, 39.546256623603625, -23.969665980519505, -16.870329930022944, -45.20944982194743, -31.374533117414806, 45.519497495877026, 28.613859284951285, -20.990519899665554, -17.888038043468878, -10.426766744763544, -41.373077361440544, -12.716085079351927, -30.179561345848338, -17.8819979111171, 1.5240673157286238, -21.199826667378233, 2.1187156270471017, 36.35459474065616, -36.048564829557776, -27.795564561537507, -14.668929255562134, -11.083603771319915, -40.21949952508327, -14.710293519498514, -37.16381247655606, 34.168828689529875, -6.649481532934941, -21.805769760342493, 28.183102386163142, -10.100588988679654, -29.101195231640677, 14.379112622671009, -4.522010022719613, 0.8193406012558068, 32.51449844518611, 6.7240655610576185, -19.52607998687463, 2.8259292830651837, -41.589779208435296, -26.804225679986043, -8.5778225351767, 30.470875714237266, 3.224234857811651, -33.79430547016362, -27.043762025787878, 0.8102655827168005, 32.15890548558894, -32.36626522866003, 15.392480048791853, 0.08166294081988275, -34.38176570320837, 9.82832392333257, -28.88366429746098, 30.423090195387267, -3.9301075540118964, -32.981728046144326, 25.945662355991384, -14.659046962687466, -43.61274543412013, 14.928431759775645, 18.681061742421935, -32.72632990111847, -7.198195612151199, -17.119748739578668, 1.5689784355647678, 21.7277440651141, -33.2682106579684, -35.50700032030118, 11.322554962103318, -12.850560369963771, -1.2024823584028632, 27.838687591385842, -8.20501751862435, -16.766102461795892, 26.92481779579863, -33.00037406305617, 24.521578944257843, -26.270432478532097, 44.154048343756, -26.047429436838215, -24.94961030966747, 44.869847808472045, 35.04814191326459, 20.151385265191514, 38.25195100015118, 15.275364487181387, -19.6612452233643, -0.3186562235208976, 30.575017959149463, -8.514014914924594, -39.041863649419696, 20.473957298165132, 11.364177085052052, -31.00000386206807, 43.02983104176795, -46.56969081540824, 32.523458752472, 21.88787008916349, 27.510829787024356, 1.4307328795098158, 41.58723852790418, -7.199587047866627, 23.592872553669757, 10.91800967442246, 31.20137292403462, 36.078064320186265, 44.38877679397844, -40.00349580213611, 43.61340488688246, 23.993890779930947, 0.9412520867969955, 1.6555362217746732, 43.59020891706127, 19.813823408612926, -46.49222676702871, -30.683535887085263, -26.404531500449565, 18.20309785997552, -5.568275022027372, -45.45113623480858, 29.737993076880578, -9.894060271863516, -30.75185448676427, 38.03399146928911, 0.003073242925247672, 33.485322113333424, -35.42669071901682, -24.461633738719048, 31.27775200045175, -20.88766701932829, 22.938163614249465, -3.591645600437654, 25.637520332429727, -34.45526939849745, -17.612965164119764, -13.645438591244304, 33.095149665115976, 25.574705477531605, 17.772381770182147, 34.042066254697964, 33.17414404655477, -26.33480901175529, 29.06261851612511, 7.710990986616022, 40.88829912219242, -22.488031297778925, -32.10579145911332, 14.663462514326364, 43.45149295598688, -40.929419791644406, -38.16310282452054, -43.116160878172295, -19.83154112656673, 39.038674581713266, 6.688722258543467, 44.692960231647454, 42.720365005664924, 35.394236692391914, 14.17804865706343, -44.58621677765723, -21.250032210711208, 12.794382106816958, -13.161674623245021, -12.80836176862736, -43.82096572567554, -6.302057175211679, 5.413008972845538, 43.627619880106415, 41.432815596758466, 0.08674917968191263, 2.2453943929680804, -39.30413391732864, 28.28478567428476, -27.236082377971233, -11.52335502421522, 41.40771502564484, 22.107728786930256, -3.6063341027524674, 19.112107443543866, 31.936067746545937, 27.283652028469533, 39.357534954134415, 25.205785569559307, -18.744103811792783, -2.632309879289531, -42.49219660670269, -28.92799747301617, -41.5642793511555, -12.062276448158013, 41.284049133556046, 8.26365951933297, -44.47505773786128, 23.251060533461477, 40.73735866879656, 17.624352734144203, -26.80094146285579, 15.61959073823596, 41.23271387633342, 29.836351656897744, -10.017285075290602, 3.8344366405925823, 9.489311335805658, -12.307360991758026, 23.19106000315339, 22.00114445535782, 11.815474532328473, 5.551499986047602, 36.72453015139255, 5.608965963804251, -36.902011952699205, -4.6288219844287015, -33.369938355870836, 17.130897139540487, -29.0922926830839, 41.31064167251721, -19.396755127350986, 3.2029731843319813, 7.777201351571877, -41.8932777129718, -5.009943002484341, -32.9507072629211, -3.5388204712327216, -37.56840315362414, -28.53499869119597, -22.888398193090747, 18.486329720994085, -4.349729081611014, -19.92992199492771, 8.145097042448038, -6.810583510632332, 44.434159150865135, 35.58713172807154, 27.019982353952088, 19.288357237790066, -43.91644271263925, -28.100145328943835, 24.93761182315563, 42.75730409796022, -41.190503242224516, 10.127953244658485, 9.92719447809739, 8.56731345827628, 41.08108816298067, 33.571037452792034, -29.37601841590918, 13.155593002705952, -40.25811559581973, -4.612995706581291, 42.023684399160096, -16.852133344213563, 23.372457878231906, 31.038010699151616, -38.72639245927526, 1.4831017901745054, 31.85159925632862, -13.904169218652816, -18.282370477012453, 45.67521010273699, 18.50278465555556, -20.960932128207183, 41.18535586783859, -13.861966042676697, 16.259395067165087, -3.8848840611093576, -24.227552988951906, -29.832901174560632, 30.474829075491648, -3.12931184467972, 33.60598871434816, -28.183134956492566, -34.226693607645124, 10.68816582241624, -25.959201462330356, 18.930073719426858, 9.888613550833583, -28.218693012287797, 5.239668406030778, 9.63299461474658, -18.63457508133317, -16.89712930542449, 21.541441229467335, -32.948581957919906, -30.66532175052664, -27.305882874365903, 43.95918997605794, 12.37714763515308, 33.1819772959839, 33.741481065200745, -5.518938996280527, -0.04520560051787914, -24.92694277906806, -32.97491261549673, 17.03955377390612, 8.898724160272543, -34.14000718009812, -0.8284479640103726, -12.910535230964584, -9.271876778202754, 36.09017164402794, -13.317843153630346, -2.954411499639214, 24.391040752362567, 39.48444239367319, -5.5795417374950445, -7.013567639893934, -6.858457833965928, 42.420957251072984, 23.589345038159788, -10.657614497913695, -8.883519215726674, -4.323278515154631, -7.174655556971722, 41.19667626540795, -5.043383396340971, -1.8221586309369031, 42.769601830665785, -3.408269299421086, 17.458951079820203, 26.422809039811767, 46.57170280392974, -5.881268376593198, 16.516432831588823, -4.758784305310908, -26.63311116833799, 29.38483042160006, 24.541951979440757]
        var treex_400 = [-18.138694133195063, 8.395592349238765, 43.12627122177034, 41.909118425029625, -2.1451326889231894, -43.70174906893274, -12.828826583454406, -33.495702520460405, 9.091127180381637, -5.152595280638728, -23.665993707416874, -28.676456030370122, 28.919961315473213, 45.66851164062883, 12.093942332366902, 39.62620141674423, 26.74915545835858, 22.768977619723163, -13.315732430340997, -15.046171526267955, -39.862171336707505, 32.0590907753087, 42.81889393309052, 41.46064825535853, -29.56696399655821, -1.9963208964060462, -29.269947067832877, 8.673424939743356, -36.30595826293896, -1.281088113635052, -3.10186305529461, -28.367280174359312, -23.85743342648597, -27.54131084932866, -30.394371656836995, 2.6134109301407475, -16.797454646226722, 26.579140347870997, 43.03510549687234, -36.507840754645514, 8.033846876077355, -17.011149068867603, -25.052796093967412, -31.22248182219028, -18.49544136709095, -35.20464098566924, 44.22744072865987, -25.061056334657785, -45.100842292338605, -37.282235325416835, -27.530192316462607, -2.9796879205803766, 32.89078133079837, 42.54840345544673, 24.518475546538358, -0.6572002016378482, -35.7105417541677, 11.338060820546081, 36.44526556324264, 15.778812385547795, -21.759597081379454, 43.39331370061043, -38.652877155658366, 5.429243811758378, -15.652755793462644, 19.37913321700086, 12.328100241711699, -15.282278583385676, -36.40558018588321, 24.036732509927496, -43.808100680923154, 8.39494027816037, 34.984931073643864, 15.317045809068814, 46.165776229992005, -7.128826484819177, 24.97637259298645, 28.320447245390728, -20.102312721799883, -2.4971278698675916, 37.196648702336205, -20.93241167457707, 4.132613862255081, -12.590612649779427, 28.20780970513103, -37.89625315769548, 15.767114304528286, 6.009646800416764, 20.96968590717699, 28.20948575533367, -3.5817062428976127, 7.177861076577365, -16.35895098729803, 31.107917489507987, -4.306416253950975, 15.15413028470547, 14.224675114699032, -35.12376173935094, 34.65014805773883, 39.2801150881305, 11.775002226752347, -10.499770070805894, 29.692342260785665, 1.5149983951807133, 2.154901019862041, 30.71883468609031, -38.303362083976324, -39.445094082904006, -29.168990091629695, -1.7076709442844713, -38.37754764694112, 33.54516805554967, -20.16816504341517, -0.8024807345279559, -6.69561325663919, -12.44528433361587, -20.191659217743013, 22.289019667701833, -23.89778675010066, 8.712640688195698, 6.0697675330856935, -6.279270367104477, -40.81994095160224, -24.787271042006946, 5.488897473981735, 32.538107177077656, -30.917179785743542, 42.8325567592784, -25.28251183494659, 41.48101583891548, 20.79808811052338, 30.554306864806087, -9.846758757863917, -0.023706430247143473, -32.41175995567707, -38.98265150271178, -18.55624098808444, 38.05455376469111, -16.358638377643747, 21.608577027937564, -3.399591406536537, -9.629013453996734, 2.9222183962456514, 36.252267762687325, 31.353782740093717, -30.951630256866352, 25.973108286789845, -10.347482410405064, -39.53700303128831, -43.107950152257764, 24.34987010173094, -43.92463990441888, -23.289268794705336, -13.547742051325026, 26.37711663479145, 20.504393207843332, 22.82722893074218, -41.57232223816859, 23.938913264009255, 41.613264534091805, 22.386513087921685, 16.040747430221987, 39.04874618989849, -38.466259327577305, 0.17411431777988245, 18.380839754163787, -17.277628399370695, -39.06062620076001, 24.44713595617907, -27.57564222471915, 1.9128426392055116, -24.764221697662276, -12.130888744265024, 3.404641062637326, -30.15760772614771, -12.456297159421496, 44.26538559386081, 8.574192426685986, 9.611790066722122, 34.835486199470694, 4.844978458761058, 11.722907174192565, 33.30043938785747, 39.739145701463315, 38.5763478006523, 43.168759595488226, 32.14839561798375, 5.1310710224806515, -42.31288242444564, -13.519923533627114, -28.907027818361136, 15.17281519699687, 40.767047101396386, 12.882018534691554, 26.628427664829275, 32.21664432352491, -35.88886615757004, 38.74318308444911, -5.8961205730333575, -30.08037321596695, 1.8810726339590056, -41.58487135224736, -14.433622764723419, 2.728557554489445, -6.124741388482025, 36.93814127436757, -8.865849130777036, 24.086284930356715, 21.25581655572701, -17.27596282369161, -5.618520732856782, -21.1602010685721, 19.071527275628696, -25.90810508862389, -38.46112582438722, 34.6856292724479, -35.28577595511774, -45.703585090024916, 4.717307895841436, 11.957709208237493, 39.28590070863865, -34.16014949762482, -8.40542872846166, 4.665835148952209, -45.53207183206387, -30.638448129629804, -33.39869732774035, -44.048884347323806, 17.370277824706427, 9.616030994391012, -24.595411121913997, 11.069627613444053, -11.604846857645885, -19.64686818812162, 7.911432656031915, -13.660195885377172, -27.33708446835284, 38.0010582754746, -7.7485982097520685, 43.15450488975164, -41.43115931280816, 18.49809163630661, -22.862893412081284, 15.729876987523317, 29.304626536134037, 27.32714164060017, -3.934496144200493, 3.9026747534445416, 5.483144348310492, 17.507899567296814, 45.01181843567724, 19.237624397315756, 41.278823068595344, 20.92303185275018, -0.12970809509576142, -15.101948575588498, -26.943450161439493, -2.9803165734176167, -9.382092282474417, 26.416044993365055, 35.72930820197031, -40.37109925166731, -36.494674775332115, -2.06337718948586, 34.93895858870071, 33.5160300685807, -19.66762616163732, 35.22847349952056, -18.247374182350963, -33.03014972721228, -19.0153007878556, 3.384730384849334, -23.509191561700852, -29.734883394327756, -10.367939880702023, -22.72815115691924, -20.472616697185817, -42.48357814742161, 27.4923703955832, -6.909127448691049, -20.169092949083975, -44.00817195021015, 38.39174121829563, -8.422538977520283, -3.3490000082893436, -34.97435773411744, 2.145149024794174, 44.59221348474943, 21.46633596175024, -29.970529214443342, -43.79212996487316, 22.784171233008514, 41.375792003535835, -35.653437382676984, 28.47051632307288, 13.469012953678842, -24.561833273366194, -27.395525769117643, -9.194889727012123, -25.840890700839815, -8.463435361373902, 34.21199150214086, -12.88611584782976, -27.81358486948883, -13.316996496376232, 1.8515141697330335, 11.61554386331509, 1.894309240054975, 15.103878359363774, 22.43238193809442, 29.490251947252233, -39.884522640185494, -7.658819497451724, 46.18201212149652, 22.97512556348272, -34.14731071415268, -13.83682682072516, 26.28691152673295, -14.905621071016652, 35.42179802786052, 45.590205259367615, 26.754096082169355, 44.91858279114234, 15.270329548001763, -43.13924367998359, -45.36607202398507, 34.712779258638115, 12.65620772144874, -7.219353740888051, 43.66431937301739, 46.026135701558474, 0.1037728971840952, 13.722028866908666, 18.320581779999458, 32.12359903211056, 20.469022210202812, -45.06311135057117, -28.317915140823562, 23.057790911527363, 11.449502259784088, -37.37196655048819, 8.583671708146095, -33.4961101900414, 29.179004020718146, 44.28396208446631, -45.804509389547604, 18.202687847027875, 10.701910951187928, -37.76724096112215, 27.342708728839977, -7.377050221645849, 10.173152518491296, -45.96550430940408, -19.474646296847904, -17.06668668299723, 9.700995691416528, -0.12556057423536693, 12.818449126161884, 38.505471988068535, 17.10050379425026, -10.187189996245957, -15.61533493423418, 6.5942769659994305, 2.7881800122074836, 38.15715427797878, 14.343547974540968, -8.880292758390016, 4.455994344075115, -21.500296136353008, -42.32158041833041, -8.11782219968822, 35.06153922124551, 28.36053072309169, 12.067537485270233, -18.7967841915979, 3.177167117732496, -7.791551475599627, -20.12606805571896, 31.745217824350405, -28.072517004367953, -29.376453597809416, -35.53739467386919, 25.898130985796545, -45.54536077176777, -37.17672844223933, 4.305435140479195, -39.12265153454462, 21.731234102530536, -16.22845152733436, -14.835116635514012, 37.86820088484022, 24.50736880621836, 35.44515165556276, -45.72482809415262, -4.46083908065733, -31.259874276919955, 14.932012324214101, -19.024726318298992, -22.303449485595443, 14.587441008351155]

        // for density 500
        var treey_500 = [15.334598628636938, -23.608528593194084, -26.22498478690069, 38.26353076107781, 9.419666439993716, -34.00464788736312, -20.054235717963593, -9.874007277117373, -12.932147626928536, -16.61469337094475, -45.44663834498662, -32.62409561261225, -25.23776428302303, -16.675347253859172, -21.200679457240412, -20.32370164978262, -18.09657264510358, -11.170246260917581, -42.92176790776461, -21.018461125617023, -43.81893396677939, -26.130195964302587, 26.184944719120338, 16.086074519959443, 17.77898473530492, 8.156033809507942, 12.883457212447338, 21.37115645903851, -26.400247551253642, 7.197961888050938, -32.897354875791535, -35.87063246757652, 1.1504683582399073, 7.32271621496519, 16.397213465477968, -12.09318917743406, -16.243218223251205, 10.714709587545263, 21.32386226946985, 16.195224784795577, -10.178992539928561, 12.268994204372099, 17.500717840908298, 3.003201676272651, -41.397755160189874, 25.010578806180753, -20.998419595146, -9.668352983784517, 27.97688926787785, 8.128418328944099, -14.96003922454928, 24.008666255802996, -17.914203728370467, 15.062869761839512, -19.416584295821984, -28.029310592913966, 31.952591707260183, -34.53863971093227, 13.845295232349674, -32.044999058123416, 19.83902288716902, -29.507480873644443, -4.314272952376892, 36.717282655730976, 24.519711576028353, 4.443024041565969, -37.50286285223523, 1.2503424706420079, -45.7481815937372, -39.23539807248765, 26.5481849104131, -26.016299778231115, 33.96721833436711, -4.70332447499775, 37.97630795759663, -33.40599466598867, -12.389709258900224, 25.47327035858352, 18.21466551128141, -17.759324837060827, -33.13022665021637, -28.972828349828422, -3.029069997497692, 23.852230926459054, 43.1645151085768, -1.8401174304528136, -3.863466399136043, 45.284126308447604, -8.148246664594001, 41.94042691858133, -24.07007133871323, -6.990709431979359, -14.879970111538972, 27.84003989913253, -11.825133240482144, -0.7022489354604224, -25.90523257437542, 36.05451147607005, 35.22401295991992, -29.24501721763928, -31.709481377551683, -41.9586902028389, 18.301005723859348, -20.29798648940735, -40.32169631912711, 32.60877454513851, -35.20654409503347, -36.536889410628056, 27.433643235079494, 1.2627137016576275, -3.26052368028483, -42.43410081373632, 23.77427783984346, -35.35505520856347, -30.335087805955702, -30.52179698901389, -42.12336261354697, 0.05445356550888496, -9.751330220860645, -43.98830018100372, -3.310108464242818, -1.7175330517828629, -15.960716801203802, -33.09648714878009, -45.100243596118816, -16.75697137376393, -7.025900492330292, -11.814914701707275, 18.075336543847435, 30.815508603618376, 3.185697822408303, 30.038259920238, -12.226775388491447, -21.41293859733213, -7.850682318208177, -43.570388157466915, -30.773188280350155, -28.9392473568327, 23.26033130077687, 9.253539424405144, -33.05230361434491, -18.58948571279914, 3.3997892204259363, -23.922878674262694, -46.036558355255785, 4.531704802993389, 34.017283611127205, 15.794628929005876, 28.973079889228377, -27.67648094081658, -13.453337559506815, 17.716002715477487, 5.182586988760243, 6.3961534521323635, 15.891793964717461, -26.08714322930728, 37.83787114912181, 32.97281165961587, -22.754688018508784, -5.615446691439907, 22.573878871101744, -14.066128306602824, 15.163006927281144, 33.79649004286747, 14.046414383203272, 40.247537440771325, 0.9553130266007699, -2.5349620961850747, 0.5920746333624651, 26.028680931155105, -33.02052974020298, -26.01742971942435, 40.39491258287604, -6.24757356751637, 21.498751472164578, -42.126569445828764, -21.103816028256922, 36.89062189337121, 11.28387001084375, 18.305129108622168, -25.276455618734825, 2.3171940982899772, 35.6074162702294, 3.7168660724804004, 32.14667974595633, -14.513412727020404, 35.69914322466368, -46.36227064467688, -37.85798704935152, 18.3949426916785, -13.501263086262476, 44.210717122899936, -0.9751368314039395, -18.538127327298835, 6.1530690879185, 41.704448731728995, 31.60440546883125, -39.00780824965395, 18.360228808526482, -18.31598431774461, 35.31111221057971, 22.565769106203746, 2.160172808254692, -37.15086628404212, 27.601828642750952, -15.382194416820859, 17.620808287557427, -17.508164115817028, -38.76810854554718, -9.489461001399238, 24.041646553193274, 27.120290437163156, -33.484928875868604, 43.46456780504244, 12.484052951285353, 40.2760118951518, 42.922713428931324, 30.345362462980827, 36.08790301293731, 40.07956838815532, 11.85191101859839, -39.09432148433891, 36.424363890310204, 4.104433090690482, -37.65121103992857, -24.689972361732405, 0.03901383260273788, 3.0276988407264174, -46.58864516922681, -11.009628389756275, 10.90043683932144, -39.55069308069061, 43.75203346616401, -34.423587308257865, -31.257615272667195, 11.788110266730143, -7.61158119034398, 26.999635904588786, -25.92805127538781, -36.85794636997397, 5.140691514076396, 9.231281004801334, -27.791851340397287, -7.205262143752137, -31.3948497601632, 11.161674461299611, 14.524070635294924, 22.217089820375428, -26.537466145249883, -10.686223303671134, -14.044717946754773, -35.1371085710179, 14.402776840840135, 25.861605972400117, 36.80950099814601, -23.217995122357266, -0.10162292379124516, 35.48639101546663, -35.91407384834924, 10.51298061352021, 32.7908591243572, -34.615429247493466, 19.200672368062353, 27.74361600962965, -34.012793621259384, 26.999315099043702, -6.038452317525674, -1.1779919037575928, -22.4002431696768, -24.45340035163953, 9.31250708903208, 4.410761900606129, -40.90087236855982, -22.048510296213124, 39.35770723746811, 13.840030414610311, 10.558647992983381, 1.6797358092982573, -7.818187222353454, 22.176472474479187, 14.278676583719447, 16.188716757545834, -15.85807987949229, -5.914828085523213, -18.011401675553877, -3.6028437438509715, 40.39995530850901, 31.771211663875487, -5.262998650379695, 41.62835235947282, 10.224382782122566, 31.086515888600452, 37.13533277926969, 25.5270378658327, -25.368079117646666, 31.519953046018987, 17.92309391088481, 23.99555015767477, 7.547130878921427, -40.38993707329537, -42.488646750380035, -13.310912921701105, 20.610827134028536, 45.151009899333935, -25.471612169587683, -22.780657836453987, 1.908737845216179, -11.030722495775448, -32.31981964432993, 0.7756922144295583, 23.66200147724501, 4.9940473763037705, -11.169115100688636, 44.16737328599597, -40.264591905583366, 33.67255031086741, 35.54422149791858, -22.334131586137442, -46.26141276726878, -10.478869328272001, 10.219104968218499, 6.9645684325125155, -23.943965919554696, 36.021657884806565, 8.892761730026715, 9.825446233765515, 11.789103298262773, -42.718552558474514, -32.508857035492326, -38.56158331049735, -10.652906270347536, 40.975270894656184, 30.748908814375035, -30.002943329610925, -11.3496101077072, 44.804596464827796, -13.464642410380591, -5.593736213241247, -30.762181622312273, 29.976924943259434, -44.058954339303014, -6.285256814888683, 25.06578568834467, -14.889497440761224, -2.443242525669673, 23.33269775159777, 36.420560911827856, 43.82874500582379, -44.64695073578929, 16.151545795219103, 43.75511910948794, 33.87455749192834, -34.336059948165904, -21.309954495367837, 13.374536882508512, 25.981547967233702, -45.25198742125446, 20.83661097959019, 20.86507709489869, 30.08384566049756, -14.629228993505674, 42.90031876083158, 34.35570302973379, -20.027724613620745, -35.77595769947452, -11.834757288251375, -17.899373451101642, -17.22067104670598, 18.312345179784305, 22.530972353854246, 39.09686129966462, -7.251912431612269, -31.219490636818087, 21.09150039228888, -43.67336485400722, 38.99247824809155, 30.518716297720168, 7.920495867913985, -0.8794357143870104, -13.69678147167369, -30.35799993188022, -10.475114614338057, -9.423822189942868, 23.746810111374288, 3.9631811174094893, 40.05810872923493, -37.95042640218936, 1.1742121944882717, 29.525033557654126, -1.3287376833604, 41.22572727816144, -28.796927662200233, 0.5808922967185397, -12.013474909707975, -2.8297676241284195, 13.977081707975655, -17.749633149842044, 4.288531171833811, -26.04047481365035, 43.10560622639712, -22.94146472447634, 12.742286096602239, 23.821569639968423, -1.4778854939740045, 28.701975281750972, 20.48929361047129, 6.612199159602477, 46.49940697384429, -39.00617061435108, -20.72959472107645, 35.455027177469255, -19.5012093824603, 25.845644235428477, 5.591159041843479, -23.17673843427845, -2.23911717132268, 31.951799126844424, -45.55886183632591, 31.757032244716875, -23.909955953150014, -4.251116930485392, 14.601664160580087, -17.539954873770405, -45.584575837585135, 17.309449543117132, 27.513764846213675, -15.146713762062078, 15.7888764882581, -6.787010314372302, 8.972572668341634, -14.983034504845612, 29.254002678107316, 42.42015246412167, -31.769159830038134, 6.326744884274617, 9.483312370783995, -27.669479860654718, 41.43383315649458, 28.73440529090607, 39.25156487144534, -37.55882922147286, 42.960479974352936, -0.454931836918786, 40.272990369592804, -44.95874011855118, -27.620286186334372, 18.840398871617378, -2.407721046054994, 18.10370297104633, 24.821989173348292, 42.021395833598646, -4.653891014644477, -1.7664843672511776, -4.476999408537635, 6.395372616441648, 46.09716758180015, -3.121448048452452, 10.227933153829067, -22.190067211540367, 42.90405813258883, 42.95806288020962, -36.44747251970336, -41.758800589673164, -28.99507269025666, 43.90927498997168, 42.562867863631475, 1.4933079985286235, -39.98446279325459, 9.819771748421205, -42.323739591217745, -42.94583986363605, -40.65707805364738, 7.4127758200781315, -41.279084076648715, 40.955279604116726, 7.471050384928295, 39.625697904134476, 39.24286034355406, 34.51504983509663, -41.26056313557334, 39.18003716645305, 44.05359504138005, -35.86703850279981, 29.987348866275443, 10.782784988391434, -2.5563188923033846, -23.979033447576825, -18.650895119372795, -11.120029456563197, -20.06626598487187, -11.794546909627073, -15.911700189178427, -41.8050021911384, 1.7864867406951968, -35.11474274186652, -37.153383167445476, -13.268222541173188, 34.57570302923699, -41.851553015505424, 32.73224685498549]
        var treex_500 = [-38.701230745902706, 5.3383078679410865, -33.769409663862696, -23.899750449965083, 3.71945391400577, -2.4991473842720486, -2.544509782562531, -31.44065821441133, -45.40121937335112, 15.691564685325064, -34.217378562081045, -36.26710852212562, 26.570118674859998, -18.75414664874872, 37.96088996490339, 28.732735577505377, -13.685270212787232, 8.302883428511679, 0.6090744139757194, -23.56792174045345, 32.358446648774404, 8.012795656897042, 23.896689528589278, -26.65945410720845, 2.005368273641988, -30.1706073200502, -43.523710590785946, -45.93792373049428, -16.902014466983978, 3.964538726103262, -26.9100447454077, -15.551990086836938, -20.747944676477466, -4.218094132216519, 5.414640993956573, 0.8868816583047291, 2.2465756371867363, 33.15855103060505, -13.711442686483686, 19.523433833514083, -41.56897738666514, 28.788450624311146, -31.35550790286681, 30.147515830504158, 7.126428981488415, 13.544577296848189, 16.683889807120373, -44.04405126878371, -9.456077052580095, 9.555388748811628, 6.420282706084633, -3.3237389623415585, -36.84691850175022, 42.27346995835069, 11.038243824093165, -43.97325467652872, 42.48211575141107, 14.782842809859472, -20.676195507169275, 38.95163706045249, -25.637332527706462, 31.107299704003395, 0.19212454232438603, -25.89636739302391, 45.72921746813218, -45.11777966124069, 9.686491861058228, -34.904575100780875, -38.915559444671196, -39.60397458228476, -40.02158648525892, -1.6756253161577903, -43.09719183062266, -45.608495565840215, -40.7462071723063, -21.975367529054765, -25.334514657730733, -18.017122833731637, -10.605855278079012, 43.31425013650771, -40.06007954698295, 41.211963915143116, 1.419464606970435, -25.87287843904121, 40.99518777380256, 37.141224319532476, -28.772943283653706, 30.196798670490452, 21.847649230555493, -46.25779529642618, -37.307965510722724, 26.8724878143637, -5.4225659133214315, -15.259878455985486, -25.78192747470171, 12.76958481010079, -41.97492474691372, -7.235087787327096, 15.725325212887629, 36.86556166432909, 8.037740586388992, -42.997606734177396, 42.040379747002575, -18.619960510937442, -14.9984511878794, 4.377814139188853, 4.499895731652143, 19.969566275385915, -44.413145042680824, 41.79109579010129, -6.818084656355047, -5.165374432657307, 20.033900706853785, -45.47997889626348, 1.6300891816668266, -6.188957462851751, 44.47935486887779, -3.8723536923781454, -3.716072157308419, -2.8008839975299504, -44.25944210874563, -30.541275101220407, 27.780902596306547, 25.96608106339314, -19.289933363595416, 29.80852524358426, -24.89896664420756, -4.626469316912038, -13.721140985217835, 12.106260127081228, 34.488795917964985, 13.338308470908991, -9.640529739827986, 32.528466599882904, 36.97857811860318, 37.707349710270435, 18.95433810341491, 27.3127716258054, 29.8113580195921, -38.51390906325137, 11.182906582744238, 32.21085390123436, 44.37347470163617, 0.6064600495673914, 14.436385023426599, -25.99674917663196, -20.41743471778615, 36.38499018765976, 28.296228834129046, -28.273704804657672, 40.214148373201866, 21.857762578394546, 39.349789721842, 8.073687110235841, 33.38155547203308, -18.11344856788589, 32.02404161285146, -40.558157277863664, 43.81354534852936, -11.783740913585563, 24.407874284320833, -1.8537034880367087, -2.974346713199413, -9.086358202396507, 12.350529890054084, -36.46731524086607, -38.87764342295885, -36.61418178935346, -14.040674752065767, -35.27596779376659, -43.16529497795972, -10.883148171797938, -4.911525252061958, -31.98153407205588, -6.527306491398663, -28.068627192694933, -31.168386162894226, -38.12575113284602, 45.90583436215713, 5.096780842102099, 21.02312970298505, 20.749744323193195, 40.04113065869609, -5.159058326502874, 36.42306195413235, -29.14999348324347, -0.30377463372975066, 22.4432956699111, -7.814909914641143, 45.162931877459194, -31.64688416547339, 28.855446027060808, 25.311881784683393, 39.849596065660776, 45.472001934708835, 16.76688476092437, -32.04034463347287, 14.79768056838168, 16.907769172526596, 36.75393747810213, 20.324759381001364, 4.110574403758417, 25.07574311792154, -36.31607337911137, -31.615001781823196, 20.033343322151993, 37.71308904027399, -42.42127912558864, 4.120178788008185, 41.45963870551303, 9.075693481413193, 12.977914709789703, -17.82203183506461, -16.051761363804673, 2.600190010520008, -30.311505207185746, -38.24237127225898, -23.603531888103223, -33.181527779334786, 38.31896046030083, 12.511850011491834, -31.704634790348678, 27.256495779169672, -31.75284308072019, 45.559149683457505, -43.153136335315764, 16.37532909783729, 27.767755643094432, -16.750950609057075, 25.451986070777643, 6.330107410131427, 36.46096037951592, -4.751809005241901, 40.51638047816393, -32.495737606448856, -1.4579357308192678, 6.176084643269835, 7.249103735590992, -5.274203856569996, -24.51395840681837, 24.23640477177773, 22.930611222800362, -34.9195203501021, -1.6338283475291528, -2.6509878838820353, 42.06721577994177, 26.407065780170846, -30.146746477717826, 10.835408809087948, 35.85151923403435, 37.55799935929205, -17.35957047875289, -12.07379170447456, 45.13336972440779, -16.83035606286555, -25.262140795065708, 27.493068203069246, 45.97284940194295, 34.70059272488512, -26.662119031491443, -2.0896028168752725, -10.801144093448015, 28.573844314077647, 20.697760754362132, -30.7553589577586, 29.838155505785355, -5.646405596251533, 5.363291817979613, 14.675014462197815, -7.441997615594784, -43.68841184979725, 37.05827437920043, 31.04741519014272, -29.57232766922658, 4.534092736968584, -4.935387085619209, -20.1018448679946, -28.720894641880594, 29.950996982352226, -41.67351725394181, 3.8367765781876253, 14.395710435563437, -9.06011948770148, 44.47363433472481, 19.466582170353913, 33.167612856774795, -10.28618113807509, -28.329897289694376, 40.84269569765757, 22.56416119113297, -31.316044718440807, 19.23231989266992, 12.436570428225892, -5.250060464421679, 11.168408598008192, 27.558523170420543, 30.8535155061825, 35.11655762361575, 25.62968228512977, -12.251626701173002, -25.907148965188476, -15.259529782876498, -3.822387857913427, 35.14280227731116, 22.003403031289825, -11.026309204990909, 9.467319803000738, 14.352920062480699, 32.00317873187013, 0.9339748408016137, 39.145184195656604, 15.470402085399865, 31.845793652829713, -33.87652747281867, -3.8217676080657084, 40.68486505921525, 3.2680583806813015, 41.598626875149556, -44.12140569662786, 45.02922877384682, -6.199461950039126, -19.56598592147062, -0.440852468499624, -10.87154502686309, 20.9098418108248, -15.836309247974885, -21.65186869229946, 7.14633899748387, 22.994909820378375, -6.789985438509329, -36.874592914976944, 1.2313055151843137, -19.058475214173797, 44.631612023848405, -20.699347587488276, 23.483155392247582, 25.073521236520914, -19.50777601732193, 13.068014943070361, 32.41906141765478, 41.85891369183907, 13.348307958600241, -23.804628304279184, 9.879863700175505, 18.061192519555476, 4.4258845802895594, 5.7817384662721105, -44.70609521271519, -33.12135183571857, 44.93094801947219, -0.19297448186648403, -13.237712461412663, 1.2798752465281171, 23.790614602364876, 23.457860182685458, 11.399803676592201, -25.07873450223119, 20.574362224102494, -21.117804493967817, -36.932241549964225, 43.06420095601706, 4.76019568384179, 22.03032430879295, 7.834653633957329, 31.260764934539747, -14.583606132945649, 2.0395957692643787, -41.299185587855206, -39.57001502479008, 27.32029927907652, 43.79319075260038, -14.612592384248149, -11.031091014528412, -36.77884826762167, -9.798643101770898, -39.016242987763334, 0.7611776787143374, 33.745117465398955, -21.878334718268654, -37.79500179044809, 36.48157219803302, 9.659693111594281, 24.05385702572499, -18.363656946201004, -24.79399330516642, -22.913714330451896, 22.75494318080082, 4.62582749180176, 41.545824869472185, -10.733087995438044, 9.56611549237583, 0.572172231350403, -42.86018388171585, 18.514153904901292, -16.467896909203027, -21.620305915432414, 23.284136567940585, -15.140756749117726, -23.06627363546334, 10.391277649275041, -20.924820308129387, -30.422524054812285, -11.842141733213834, -20.665958787727337, -1.4365169190223996, -43.08408756579439, -42.0864578925078, -27.131447352073735, 9.173771430602851, -27.18905642983746, -21.81547569732147, -4.556877835592381, 3.6024954547641967, -9.707088510934753, -41.773027117917785, 12.50239635459711, 22.33593827740586, 17.378895734722665, -45.81778649254306, -12.850219724569747, -40.61944122904686, -33.97728438350448, -10.492649375497571, 44.5187685085074, -7.917056998151528, 36.007676668376796, -23.620421125399044, -13.278551340017517, -27.21070597668515, -36.640630387113305, -40.97169452484635, -28.177041458461993, 16.81803875348477, -13.311740443047396, -37.48396056154509, 36.78003300409142, 42.399366030787355, -20.05533200712851, -24.183492071007578, 25.831489837630695, 29.577039945846764, 42.97675368065911, 43.16608028326773, -16.36544624980644, 29.4241400362528, 20.778411291334717, 11.757536341691388, -2.4067270837971986, -22.743600191954748, -34.77819458241971, 30.736746458651147, 19.669299825673086, 39.55411534801739, 8.790121657897236, 18.95861276722333, 18.950442140615937, -38.69489136554465, 15.936728451918645, -31.936782912000844, 3.93656942552717, -11.33589640017708, -25.610087566914196, 40.364591330334605, 14.030599340841173, -17.17116144847997, -21.895358604156016, -10.95314099641295, 23.145448065843766, -8.638805780130973, -34.9793990164353, 10.899448535734761, -20.255950363213394, -5.203136587810507, 26.374340785123366, -26.81310012278664, -23.894131640381374, 34.664812422017135, -1.1006839386559486, 35.22597701709048, 17.499405245687193, 18.30801158294908, -36.61349999809959, -38.2126102839936, -5.96168541357446, -45.11590813225723, 32.215049836907504, -14.703384768732523, -0.3762739974775493, -5.929651501515538, 35.00332338162956, 37.29608352947584, 13.277775339093708, -24.43798634916376, -44.92783822870172, 8.987581977404881, 22.040710697532738, -1.4002441524506701, 8.1668848232941, -12.064575020496148, -14.73568368958848]

        
        this.treePositions = [];
        
        if (this.config.forest.size == 300){
            var x = treex_300
            var y = treey_300
        }   
        if (this.config.forest.size == 400){
            var x = treex_400
            var y = treey_400
        } 
        if (this.config.forest.size == 500){
            var x = treex_500
            var y = treey_500
        }  
    
        
        for (let k = 0; k < 1; k++) {
            const treePositions = [];
            for (let i = 0; i < 1; i++) {
                for (let j = 0; j < 1; j++) {
                    // calculate min and max values within grid
                    const gridPositionMinX = treePositionMin + j * gridSize;
                    const gridPositionMaxX = treePositionMin + (j + 1) * gridSize;
                    const gridPositionMinZ = treePositionMin + i * gridSize;
                    const gridPositionMaxZ = treePositionMin + (i + 1) * gridSize;
                    
                    
                    // apply random position within grid
                    for (let l = 0; l < this.config.forest.size; l++) {
                        treePositions.push(new THREE.Vector3(
                            (x[l]),    // For random tree positions use : randomFloat(gridPositionMinX , gridPositionMaxX),     
                            0.01,
                            (y[l])     // For random tree positions use : randomFloat (gridPositionMinZ, gridPositionMaxZ)


                        ));
                     
                    }
                    

                    
                }
                
            }
            

            // shuffle grid positions and append to existing
           this.treePositions = this.treePositions.concat(shuffle(treePositions,k));
            
        }
        
    }

   
    workersMessage(callback) {
        this.workersSubscriber.push(callback);
    }

    getGround(size) {
        const geometry = new THREE.PlaneGeometry();
        geometry.rotateX(rad(90));

        const ground = new THREE.Mesh(geometry, this.groundMaterial);
        ground.scale.set(size, 1, size);

        setLayer(ground, this.stage.layer.ground);
        return ground;
    }

    getTree(index) {
        const seed = randomInt(0, this.config.forest.trees.homogeneity * 100, index);
        //console.log('seedeer',seed)

        // merge config
        const config = {
            levels: this.config.forest.trees.levels,
            twigScale: this.config.forest.trees.twigScale,
            ... this.config.forest.trees.branching,
            ... this.config.forest.trees.trunk
        };

        // add random config value noise 
        for (let key in config) {
            if (randomFloat(0.0, 1.0, seed) < 0.5) {
                config[key] = config[key] * randomFloat(this.config.forest.trees.homogeneity / 100, 1.0, seed);
            }
        }

        // set index and seed
        config.index = index;
        config.seed = seed;

        return config;
    }
    getblock1(index) {
        const block1 = new Block1(this).mesh;
        block1.position.x = this.blockPositions1[0].x;
        block1.position.z = this.blockPositions1[0].z;
        
        return block1;
    }
    getblock2(index) {
        const block2 = new Block2(this).mesh;
        block2.position.x = this.blockPositions2[0].x;
        block2.position.z = this.blockPositions2[0].z;
        
        return block2;
    }
    getblock3(index) {
        const block3 = new Block3(this).mesh;
        block3.position.x = this.blockPositions3[0].x;
        block3.position.z = this.blockPositions3[0].z;
        
        return block3;
    }

    getPerson(index) {
        return new Person(this, index);
    }
    getPerson1(index) {
        return new Person1(this, index);
    }
    getPerson2(index) {
        return new Person2(this, index);
    }
    addGround() {
        const size = this.config.forest.ground;
        const coverage = 2 * this.config.drone.height * Math.tan(rad(this.config.drone.camera.view / 2));

        // inner ground
        const inner = this.getGround(size);
        this.grounds.push(inner);
        this.scene.add(inner);

        // outer ground
        const outer = this.getGround(size + 2 * coverage);
        outer.material.transparent = true;
        outer.material.opacity = 0.7;
        outer.position.y = -0.01;
        this.grounds.push(outer);
        //this.scene.add(outer);
    }

    addTrees() {
        const workerConfigs = [];
        for (let i = 0; i < this.trees.length; i++) {
            workerConfigs.push(this.getTree(i));
        }

        // init workers
        this.workers.forEach((worker) => { worker.terminate(); });
        this.workers = getWorkers();

        // worker status
        let done = 0;
        this.stage.status('Loading', 0);

        // start workers
        splitArray(workerConfigs, this.workers.length).forEach((configs, i) => {
            this.workers[i].postMessage({
                method: 'getTrees',
                params: {
                    configs: configs,
                    chunks: 10
                }
            });

            this.workers[i].onmessage = ((e) => {
                const { trees } = e.data;

                trees.forEach((tree) => {
                    // tree trunk
                    const treeGeometry = new THREE.BufferGeometry();
                    treeGeometry.setAttribute('position', createFloatAttribute(tree.verts, 3));
                    treeGeometry.setAttribute('normal', normalizeAttribute(createFloatAttribute(tree.normals, 3)));
                    treeGeometry.setAttribute('uv', createFloatAttribute(tree.UV, 2));
                    treeGeometry.setIndex(createIntAttribute(tree.faces, 1));

                    // tree twigs
                    const twigGeometry = new THREE.BufferGeometry();
                    twigGeometry.setAttribute('position', createFloatAttribute(tree.vertsTwig, 3));
                    twigGeometry.setAttribute('normal', normalizeAttribute(createFloatAttribute(tree.normalsTwig, 3)));
                    twigGeometry.setAttribute('uv', createFloatAttribute(tree.uvsTwig, 2));
                    twigGeometry.setIndex(createIntAttribute(tree.facesTwig, 1));

                    // tree twigs leaf type
                    let twigLeafType = this.config.forest.trees.type;
                    if (twigLeafType == 'mixed-leaf') {
                        twigLeafType = ['needle-leaf', 'broad-leaf'][randomInt(0, 1, tree.index)];
                    }

                    // tree trunk and twigs
                    const treeGroup = new THREE.Group();
                    treeGroup.add(new THREE.Mesh(treeGeometry, this.treeMaterial));
                    treeGroup.add(new THREE.Mesh(twigGeometry, this.twigMaterials[twigLeafType]));

                    // tree position
                    treeGroup.scale.multiplyScalar(3);
                    treeGroup.position.set(
                        this.treePositions[tree.index].x,
                        this.treePositions[tree.index].y,
                        this.treePositions[tree.index].z
                    );
                    treeGroup.rotateY(rad(randomInt(0, 360, tree.index)));

                    // update tree
                    if (this.trees[tree.index]) {
                        treeGroup.position.set(
                            this.trees[tree.index].position.x,
                            this.trees[tree.index].position.y,
                            this.trees[tree.index].position.z
                        );
                        this.scene.remove(this.trees[tree.index]);
                    }

                    // add tree
                    setLayer(treeGroup, this.stage.layer.trees);
                    this.trees[tree.index] = treeGroup;
                    this.scene.add(treeGroup);

                    // update workers status
                    this.stage.status('Loading', Math.round(++done * 100 / this.trees.length));
                });

                // workers finished
                const finished = this.trees.length == done;
                this.workersSubscriber.forEach((callback) => { callback(finished); });
            }).bind(this);
        });

        // update ground
        this.update();
    }
    addblocks1() {
        const block1 = [];
        for (let i = 0; i <= 0; i++) {
            block1.push(this.getblock1(i));
            
        }
        // append persons
        block1.forEach((block1, i) => {
            this.block1[i] = block1;
            this.scene.add(block1);
           
        });
    }
    addblocks2() {
        const block2 = [];
        for (let i = 0; i <= 0; i++) {
            block2.push(this.getblock2(i));
            
        }
        // append persons
        block2.forEach((block2, i) => {
            this.block2[i] = block2;
            this.scene.add(block2);
           
        });
    }
    addblocks3() {
        const block3 = [];
        for (let i = 0; i <= 0; i++) {
            block3.push(this.getblock3(i));
            
        }
        // append persons
        block3.forEach((block3, i) => {
            this.block3[i] = block3;
            this.scene.add(block3);
           
        });
    }
    blockMoveTest1(currentTime) {
        if(!currentTime) {
            this.startTime = 0;
            requestAnimationFrame(this.blockMoveTest1);
            return;
        }
        else if (!this.startTime) {
            this.startTime = currentTime;
        }
        const start = new THREE.Vector3( this.config.forest.block1startx, 0, this.config.forest.block1starty);
        const end = new THREE.Vector3(this.config.forest.block1endx , 0, this.config.forest.block1endy);
        
        const blockSpeed = this.config.forest.blockSpeed;

        const moveDuration = start.distanceTo(end) / blockSpeed * 1000;
        
        if (moveDuration <=0) {
            return;
        }
        const deltaTime = currentTime - this.startTime;
        const trajectoryTime = deltaTime / moveDuration;
        
        if(deltaTime <= moveDuration) {
            const current = new THREE.Vector3();
            const trajectory = new THREE.Line3(start, end);
            trajectory.at(trajectoryTime, current);

            this.block1.forEach((block1) => {
            this.block1[1] = block1;
                
            block1.position.x = current.x;
            block1.position.z = current.z;
            })
            requestAnimationFrame(this.blockMoveTest1);
        }
        else {
            
        }
                
    }
    blockMoveTest2(currentTime) {
        if(!currentTime) {
            this.startTime = 0;
            requestAnimationFrame(this.blockMoveTest2);
            return;
        }
        else if (!this.startTime) {
            this.startTime = currentTime;
        }
        const start = new THREE.Vector3( this.config.forest.block2startx, 0, this.config.forest.block2starty);
        const end = new THREE.Vector3(this.config.forest.block2endx , 0, this.config.forest.block2endy);
        
        const blockSpeed = this.config.forest.blockSpeed;

        const moveDuration = start.distanceTo(end) / blockSpeed * 1000;
        
        if (moveDuration <=0) {
            return;
        }
        const deltaTime = currentTime - this.startTime;
        const trajectoryTime = deltaTime / moveDuration;
        
        if(deltaTime <= moveDuration) {
            const current = new THREE.Vector3();
            const trajectory = new THREE.Line3(start, end);
            trajectory.at(trajectoryTime, current);

            this.block2.forEach((block2) => {
            this.block2[1] = block2;
                
            block2.position.x = current.x;
            block2.position.z = current.z;
            })
            requestAnimationFrame(this.blockMoveTest2);
        }
        else {
            
        }
                
    }
    blockMoveTest3(currentTime) {
        if(!currentTime) {
            this.startTime = 0;
            requestAnimationFrame(this.blockMoveTest3);
            return;
        }
        else if (!this.startTime) {
            this.startTime = currentTime;
        }
        const start = new THREE.Vector3( this.config.forest.block3startx, 0, this.config.forest.block3starty);
        const end = new THREE.Vector3(this.config.forest.block3endx , 0, this.config.forest.block3endy);
        
        const blockSpeed = this.config.forest.blockSpeed;

        const moveDuration = start.distanceTo(end) / blockSpeed * 1000;
        
        if (moveDuration <=0) {
            return;
        }
        const deltaTime = currentTime - this.startTime;
        const trajectoryTime = deltaTime / moveDuration;
        
        if(deltaTime <= moveDuration) {
            const current = new THREE.Vector3();
            const trajectory = new THREE.Line3(start, end);
            trajectory.at(trajectoryTime, current);

            this.block3.forEach((block3) => {
            this.block3[1] = block3;
                
            block3.position.x = current.x;
            block3.position.z = current.z;
            })
            requestAnimationFrame(this.blockMoveTest3);
        }
        else {
            
        }
                
    }


    addPersons() {
        const persons = [];
        for (let i = 0; i < this.persons.length; i++) {
            this.persons[i] = this.getPerson(i);
        }
    }
    addPersons1() {
        for (let i = 0; i < this.persons1.length; i++) {
            this.persons1[i] = this.getPerson1(i);
        }
    }
    addPersons2() {
        for (let i = 0; i < this.persons2.length; i++) {
            this.persons2[i] = this.getPerson2(i);
        }
    }

    removeTrees() {
        // remove all trees
        this.trees.forEach((tree) => { this.scene.remove(tree); });
        this.trees = [...new Array(this.config.forest.size)];

        // update positions
        this.init();
    }

    removePersons() {
        // remove all persons
        this.persons.forEach(async (person) => { this.scene.remove(person.person); });
        this.persons = [... new Array(this.config.forest.persons.count)];
    }
    removePersons1() {
        // remove all persons
        this.persons1.forEach(async (person1) => { this.scene.remove(person1.person1); });
        this.persons1 = [... new Array(this.config.forest.persons1.count1)];
    }
    removePersons2() {
        // remove all persons
        this.persons2.forEach(async (person2) => { this.scene.remove(person2.person2); });
        this.persons2 = [... new Array(this.config.forest.persons2.count2)];
    }
    removeblocks1() {
        // remove all persons
        this.block1.forEach(async (block1) => { this.scene.remove(block1); });
        this.block1 = [... new Array(this.config.forest.blocks1)];
    }
    removeblocks2() {
        // remove all persons
        this.block2.forEach(async (block2) => { this.scene.remove(block2); });
        this.block2 = [... new Array(this.config.forest.blocks2)];
    }
    removeblocks3() {
        // remove all persons
        this.block3.forEach(async (block3) => { this.scene.remove(block3); });
        this.block3 = [... new Array(this.config.forest.blocks3)];
    }
    async update() {
        const coverage = 2 * this.config.drone.height * Math.tan(rad(this.config.drone.camera.view / 2));
        const sizeInner = this.config.forest.ground;
        const sizeOuter = sizeInner + 2 * coverage;
        

        // ground position constraints
        const treeMargin = 1;
        //const treePositionMin = -sizeInner / 2 + coverage / 2 + treeMargin;
        //const treePositionMax = sizeInner / 2 - coverage / 2 - treeMargin;
        const treePositionMin = -sizeInner /  2.1 + treeMargin;
        const treePositionMax = sizeInner /   2.1 - treeMargin;

        // hide trees outside margin area
        this.trees.forEach((tree) => {
            if (tree) {
                const treeInsideX = tree.position.x >= treePositionMin && tree.position.x <= treePositionMax;
                const treeInsideY = tree.position.z >= treePositionMin && tree.position.z <= treePositionMax;
                tree.visible = treeInsideX && treeInsideY;
            }
        });

        // update ground size
        this.grounds[0].scale.set(sizeInner, 1, sizeInner);
        this.grounds[1].scale.set(sizeOuter, 1, sizeOuter);


        const block1Margin = 2;
        const block1PositionMin = -sizeInner / 2 + block1Margin;
        const block1PositionMax = sizeInner / 2 - block1Margin;
        const block2Margin = 2;
        const block2PositionMin = -sizeInner / 2 + block2Margin;
        const block2PositionMax = sizeInner / 2 - block2Margin;
        const block3Margin = 2;
        const block3PositionMin = -sizeInner / 2 + block3Margin;
        const block3PositionMax = sizeInner / 2 - block3Margin;

        this.blockPositions1 = [];
        for (let i = 0; i <= 0; i++) {
            this.blockPositions1.push({
                x: this.config.forest.block1startx, // randomFloat(personPositionMin, personPositionMax),
                y: 0,
                z: this.config.forest.block1starty //randomFloat(personPositionMin, personPositionMax)
                
            });
        }
        this.blockPositions2 = [];
        for (let i = 0; i <= 0; i++) {
            this.blockPositions2.push({
                x: this.config.forest.block2startx, // randomFloat(personPositionMin, personPositionMax),
                y: 0,
                z: this.config.forest.block2starty //randomFloat(personPositionMin, personPositionMax)
                
            });
        }
        this.blockPositions3 = [];
        for (let i = 0; i <= 0; i++) {
            this.blockPositions3.push({
                x: this.config.forest.block3startx, // randomFloat(personPositionMin, personPositionMax),
                y: 0,
                z: this.config.forest.block3starty //randomFloat(personPositionMin, personPositionMax)
                
            });
        }

        this.block1.forEach((block1) => {
            if (block1) {
                const block1InsideX = block1.position.x > block1PositionMin && block1.position.x < block1PositionMax;
                const block1InsideY = block1.position.z > block1PositionMin && block1.position.z < block1PositionMax;
                block1.visible = block1InsideX && block1InsideY;
            }
        });
        this.block2.forEach((block2) => {
            if (block2) {
                const block2InsideX = block2.position.x > block2PositionMin && block2.position.x < block2PositionMax;
                const block2InsideY = block2.position.z > block2PositionMin && block2.position.z < block2PositionMax;
                block2.visible = block2InsideX && block2InsideY;
            }
        });
        this.block3.forEach((block3) => {
            if (block3) {
                const block3InsideX = block3.position.x > block3PositionMin && block3.position.x < block3PositionMax;
                const block3InsideY = block3.position.z > block3PositionMin && block3.position.z < block3PositionMax;
                block3.visible = block3InsideX && block3InsideY;
            }
        });
    }

    async export(zip) {
        const forest = zip.folder('forest');

        // export trees
        const trees = { positions: [] };
        for (let i = 0; i < this.trees.length; i++) {
            const tree = this.trees[i];
            if (tree.visible) {
                trees.positions.push(tree.position);
            }
        }
        forest.file('trees.json', JSON.stringify(trees, null, 4));

        // export persons
        const persons = { tracks: [] };
        for (let i = 0; i < this.persons.length; i++) {
           const person = this.persons[i];
           persons.tracks.push(person.track);
        }
        forest.file('persons.json', JSON.stringify(persons, null, 4));

    }

    async clear() {
        // clear all persons
        this.persons.forEach(async (person) => { await person.clear(); });
        this.persons1.forEach(async (person1) => { await person1.clear(); });
        //this.persons2.forEach(async (person2) => { await person2.clear(); });
       
    }

    async reset() {
        
        await this.clear();
       
        await this.update();

        
        this.addblocks1();
        this.addblocks2();
        this.addblocks3();
        
       
        await sleep(100);
    }
}


